"use strict"
var _typeof2="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj}
!function(f){if("object"===("undefined"==typeof exports?"undefined":_typeof2(exports))&&"undefined"!=typeof module)module.exports=f()
else if("function"==typeof define&&define.amd)define([],f)
else{var g
g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.Tribute=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require
if(!u&&a)return a(o,!0)
if(i)return i(o,!0)
var f=Error("Cannot find module '"+o+"'")
throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}}
t[o][0].call(l.exports,function(e){var n=t[o][1][e]
return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o])
return s}({1:[function(require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0})
var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i]
descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),_utils=require("./utils"),_TributeEvents=(_interopRequireDefault(_utils),require("./TributeEvents")),_TributeEvents2=_interopRequireDefault(_TributeEvents),_TributeMenuEvents=require("./TributeMenuEvents"),_TributeMenuEvents2=_interopRequireDefault(_TributeMenuEvents),_TributeRange=require("./TributeRange"),_TributeRange2=_interopRequireDefault(_TributeRange),_TributeSearch=require("./TributeSearch"),_TributeSearch2=_interopRequireDefault(_TributeSearch),Tribute=function(){function Tribute(_ref){var _this=this,_ref$values=_ref.values,values=void 0===_ref$values?null:_ref$values,_ref$iframe=_ref.iframe,iframe=void 0===_ref$iframe?null:_ref$iframe,_ref$selectClass=_ref.selectClass,selectClass=void 0===_ref$selectClass?"highlight":_ref$selectClass,_ref$trigger=_ref.trigger,trigger=void 0===_ref$trigger?"@":_ref$trigger,_ref$selectTemplate=_ref.selectTemplate,selectTemplate=void 0===_ref$selectTemplate?null:_ref$selectTemplate,_ref$menuItemTemplate=_ref.menuItemTemplate,menuItemTemplate=void 0===_ref$menuItemTemplate?null:_ref$menuItemTemplate,_ref$lookup=_ref.lookup,lookup=void 0===_ref$lookup?"key":_ref$lookup,_ref$fillAttr=_ref.fillAttr,fillAttr=void 0===_ref$fillAttr?"value":_ref$fillAttr,_ref$collection=_ref.collection,collection=void 0===_ref$collection?null:_ref$collection,_ref$menuContainer=_ref.menuContainer,menuContainer=void 0===_ref$menuContainer?null:_ref$menuContainer,_ref$noMatchTemplate=_ref.noMatchTemplate,noMatchTemplate=void 0===_ref$noMatchTemplate?null:_ref$noMatchTemplate,_ref$requireLeadingSp=_ref.requireLeadingSpace,requireLeadingSpace=void 0===_ref$requireLeadingSp?!0:_ref$requireLeadingSp,_ref$allowSpaces=_ref.allowSpaces,allowSpaces=void 0===_ref$allowSpaces?!1:_ref$allowSpaces,_ref$replaceTextSuffi=_ref.replaceTextSuffix,replaceTextSuffix=void 0===_ref$replaceTextSuffi?null:_ref$replaceTextSuffi
if(_classCallCheck(this,Tribute),this.menuSelected=0,this.current={},this.inputEvent=!1,this.isActive=!1,this.menuContainer=menuContainer,this.allowSpaces=allowSpaces,this.replaceTextSuffix=replaceTextSuffix,values)this.collection=[{trigger:trigger,iframe:iframe,selectClass:selectClass,selectTemplate:(selectTemplate||Tribute.defaultSelectTemplate).bind(this),menuItemTemplate:(menuItemTemplate||Tribute.defaultMenuItemTemplate).bind(this),noMatchTemplate:function(t){return"function"==typeof t?t.bind(_this):function(){return'<li class="no-match">No match!</li>'}.bind(_this)}(noMatchTemplate),lookup:lookup,fillAttr:fillAttr,values:values,requireLeadingSpace:requireLeadingSpace}]
else{if(!collection)throw Error("[Tribute] No collection specified.")
this.collection=collection.map(function(item){return{trigger:item.trigger||trigger,iframe:item.iframe||iframe,selectClass:item.selectClass||selectClass,selectTemplate:(item.selectTemplate||Tribute.defaultSelectTemplate).bind(_this),menuItemTemplate:(item.menuItemTemplate||Tribute.defaultMenuItemTemplate).bind(_this),noMatchTemplate:function(t){return"function"==typeof t?t.bind(_this):null}(noMatchTemplate),lookup:item.lookup||lookup,fillAttr:item.fillAttr||fillAttr,values:item.values,requireLeadingSpace:item.requireLeadingSpace}})}new _TributeRange2["default"](this),new _TributeEvents2["default"](this),new _TributeMenuEvents2["default"](this),new _TributeSearch2["default"](this)}return _createClass(Tribute,[{key:"triggers",value:function(){return this.collection.map(function(config){return config.trigger})}},{key:"attach",value:function(el){if(!el)throw Error("[Tribute] Must pass in a DOM node or NodeList.")
if("undefined"!=typeof jQuery&&el instanceof jQuery&&(el=el.get()),el.constructor===NodeList||el.constructor===HTMLCollection||el.constructor===Array)for(var length=el.length,i=0;length>i;++i)this._attach(el[i])
else this._attach(el)}},{key:"_attach",value:function(el){el.hasAttribute("data-tribute")&&console.warn("Tribute was already bound to "+el.nodeName),this.ensureEditable(el),this.events.bind(el),el.setAttribute("data-tribute",!0)}},{key:"ensureEditable",value:function(element){if(-1===Tribute.inputTypes().indexOf(element.nodeName)){if(!element.contentEditable)throw Error("[Tribute] Cannot bind to "+element.nodeName)
element.contentEditable=!0}}},{key:"createMenu",value:function(){var wrapper=this.range.getDocument().createElement("div"),ul=this.range.getDocument().createElement("ul")
return wrapper.className="tribute-container",wrapper.appendChild(ul),this.menuContainer?this.menuContainer.appendChild(wrapper):this.range.getDocument().body.appendChild(wrapper)}},{key:"showMenuFor",value:function(element,scrollTo){var _this2=this
if(!this.isActive||this.current.element!==element||this.current.mentionText!==this.currentMentionTextSnapshot){this.currentMentionTextSnapshot=this.current.mentionText,this.menu||(this.menu=this.createMenu(),this.menuEvents.bind(this.menu)),this.isActive=!0,this.menuSelected=0,this.current.mentionText||(this.current.mentionText="")
var processValues=function(values){if(_this2.isActive){var items=_this2.search.filter(_this2.current.mentionText,values,{pre:"<span>",post:"</span>",extract:function(el){if("string"==typeof _this2.current.collection.lookup)return el[_this2.current.collection.lookup]
if("function"==typeof _this2.current.collection.lookup)return _this2.current.collection.lookup(el)
throw Error("Invalid lookup attribute, lookup must be string or function.")}})
_this2.current.filteredItems=items
var ul=_this2.menu.querySelector("ul")
if(_this2.range.positionMenuAtCaret(scrollTo),!items.length){var noMatchEvent=new CustomEvent("tribute-no-match",{detail:_this2.menu})
return _this2.current.element.dispatchEvent(noMatchEvent),void(_this2.current.collection.noMatchTemplate?ul.innerHTML=_this2.current.collection.noMatchTemplate():_this2.hideMenu())}ul.innerHTML="",items.forEach(function(item,index){var li=_this2.range.getDocument().createElement("li")
li.setAttribute("data-index",index),li.addEventListener("mouseenter",function(e){var li=e.target,index=li.getAttribute("data-index")
_this2.events.setActiveLi(index)}),_this2.menuSelected===index&&(li.className=_this2.current.collection.selectClass),li.innerHTML=_this2.current.collection.menuItemTemplate(item),ul.appendChild(li)})}}
"function"==typeof this.current.collection.values?this.current.collection.values(this.current.mentionText,processValues):processValues(this.current.collection.values)}}},{key:"showMenuForCollection",value:function(element,collectionIndex){element!==document.activeElement&&this.placeCaretAtEnd(element),this.current.collection=this.collection[collectionIndex||0],this.current.externalTrigger=!0,this.current.element=element,element.isContentEditable?this.insertTextAtCursor(this.current.collection.trigger):this.insertAtCaret(element,this.current.collection.trigger),this.showMenuFor(element)}},{key:"placeCaretAtEnd",value:function(el){if(el.focus(),void 0!==window.getSelection&&void 0!==document.createRange){var range=document.createRange()
range.selectNodeContents(el),range.collapse(!1)
var sel=window.getSelection()
sel.removeAllRanges(),sel.addRange(range)}else if(void 0!==document.body.createTextRange){var textRange=document.body.createTextRange()
textRange.moveToElementText(el),textRange.collapse(!1),textRange.select()}}},{key:"insertTextAtCursor",value:function(text){var sel,range
sel=window.getSelection(),range=sel.getRangeAt(0),range.deleteContents()
var textNode=document.createTextNode(text)
range.insertNode(textNode),range.selectNodeContents(textNode),range.collapse(!1),sel.removeAllRanges(),sel.addRange(range)}},{key:"insertAtCaret",value:function(textarea,text){var scrollPos=textarea.scrollTop,caretPos=textarea.selectionStart,front=textarea.value.substring(0,caretPos),back=textarea.value.substring(textarea.selectionEnd,textarea.value.length)
textarea.value=front+text+back,caretPos+=text.length,textarea.selectionStart=caretPos,textarea.selectionEnd=caretPos,textarea.focus(),textarea.scrollTop=scrollPos}},{key:"hideMenu",value:function(){this.menu&&(this.menu.style.cssText="display: none;",this.isActive=!1,this.menuSelected=0,this.current={})}},{key:"selectItemAtIndex",value:function(index,originalEvent){if(index=parseInt(index),"number"==typeof index){var item=this.current.filteredItems[index],content=this.current.collection.selectTemplate(item)
null!==content&&this.replaceText(content,originalEvent,item)}}},{key:"replaceText",value:function(content,originalEvent,item){this.range.replaceTriggerText(content,!0,!0,originalEvent,item)}},{key:"_append",value:function(collection,newValues,replace){if("function"==typeof collection.values)throw Error("Unable to append to values, as it is a function.")
replace?collection.values=newValues:collection.values=collection.values.concat(newValues)}},{key:"append",value:function(collectionIndex,newValues,replace){var index=parseInt(collectionIndex)
if("number"!=typeof index)throw Error("please provide an index for the collection to update.")
var collection=this.collection[index]
this._append(collection,newValues,replace)}},{key:"appendCurrent",value:function(newValues,replace){if(!this.isActive)throw Error("No active state. Please use append instead and pass an index.")
this._append(this.current.collection,newValues,replace)}}],[{key:"defaultSelectTemplate",value:function(item){return void 0===item?null:this.range.isContentEditable(this.current.element)?'<span class="tribute-mention">'+(this.current.collection.trigger+item.original[this.current.collection.fillAttr])+"</span>":this.current.collection.trigger+item.original[this.current.collection.fillAttr]}},{key:"defaultMenuItemTemplate",value:function(matchItem){return matchItem.string}},{key:"inputTypes",value:function(){return["TEXTAREA","INPUT"]}}]),Tribute}()
exports["default"]=Tribute,module.exports=exports["default"]},{"./TributeEvents":2,"./TributeMenuEvents":3,"./TributeRange":4,"./TributeSearch":5,"./utils":7}],2:[function(require,module,exports){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0})
var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return void 0===obj?"undefined":_typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":void 0===obj?"undefined":_typeof2(obj)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i]
descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TributeEvents=function(){function TributeEvents(tribute){_classCallCheck(this,TributeEvents),this.tribute=tribute,this.tribute.events=this}return _createClass(TributeEvents,[{key:"bind",value:function(element){element.addEventListener("keydown",this.keydown.bind(element,this),!1),element.addEventListener("keyup",this.keyup.bind(element,this),!1),element.addEventListener("input",this.input.bind(element,this),!1)}},{key:"keydown",value:function(instance,event){instance.shouldDeactivate(event)&&(instance.tribute.isActive=!1,instance.tribute.hideMenu())
var element=this
instance.commandEvent=!1,TributeEvents.keys().forEach(function(o){o.key===event.keyCode&&(instance.commandEvent=!0,instance.callbacks()[o.value.toLowerCase()](event,element))})}},{key:"input",value:function(instance,event){instance.inputEvent=!0,instance.keyup.call(this,instance,event)}},{key:"click",value:function(instance,event){var tribute=instance.tribute
if(tribute.menu&&tribute.menu.contains(event.target)){var li=event.target
for(event.preventDefault(),event.stopPropagation();"li"!==li.nodeName.toLowerCase();)if(li=li.parentNode,!li||li===tribute.menu)throw Error("cannot find the <li> container for the click")
tribute.selectItemAtIndex(li.getAttribute("data-index"),event),tribute.hideMenu()}else tribute.current.element&&!tribute.current.externalTrigger&&(tribute.current.externalTrigger=!1,setTimeout(function(){return tribute.hideMenu()}))}},{key:"keyup",value:function(instance,event){var _this=this
if(instance.inputEvent&&(instance.inputEvent=!1),instance.updateSelection(this),27!==event.keyCode){if(!instance.tribute.isActive){var _ret=function(){var keyCode=instance.getKeyCode(instance,_this,event)
if(isNaN(keyCode)||!keyCode)return{v:void 0}
var trigger=instance.tribute.triggers().find(function(trigger){return trigger.charCodeAt(0)===keyCode})
void 0!==trigger&&instance.callbacks().triggerChar(event,_this,trigger)}()
if("object"===(void 0===_ret?"undefined":_typeof(_ret)))return _ret.v}(instance.tribute.current.trigger&&instance.commandEvent===!1||instance.tribute.isActive&&8===event.keyCode)&&instance.tribute.showMenuFor(this,!0)}}},{key:"shouldDeactivate",value:function(event){if(!this.tribute.isActive)return!1
if(0===this.tribute.current.mentionText.length){var eventKeyPressed=!1
return TributeEvents.keys().forEach(function(o){event.keyCode===o.key&&(eventKeyPressed=!0)}),!eventKeyPressed}return!1}},{key:"getKeyCode",value:function(instance,el,event){var tribute=instance.tribute,info=tribute.range.getTriggerInfo(!1,!1,!0,tribute.allowSpaces)
return info?info.mentionTriggerChar.charCodeAt(0):!1}},{key:"updateSelection",value:function(el){this.tribute.current.element=el
var info=this.tribute.range.getTriggerInfo(!1,!1,!0,this.tribute.allowSpaces)
info&&(this.tribute.current.selectedPath=info.mentionSelectedPath,this.tribute.current.mentionText=info.mentionText,this.tribute.current.selectedOffset=info.mentionSelectedOffset)}},{key:"callbacks",value:function(){var _this2=this
return{triggerChar:function(e,el,trigger){var tribute=_this2.tribute
tribute.current.trigger=trigger
var collectionItem=tribute.collection.find(function(item){return item.trigger===trigger})
tribute.current.collection=collectionItem,tribute.inputEvent&&tribute.showMenuFor(el,!0)},enter:function(e,el){_this2.tribute.isActive&&(e.preventDefault(),e.stopPropagation(),setTimeout(function(){_this2.tribute.selectItemAtIndex(_this2.tribute.menuSelected,e),_this2.tribute.hideMenu()},0))},escape:function(e,el){_this2.tribute.isActive&&(e.preventDefault(),e.stopPropagation(),_this2.tribute.isActive=!1,_this2.tribute.hideMenu())},tab:function(e,el){_this2.callbacks().enter(e,el)},up:function(e,el){if(_this2.tribute.isActive){e.preventDefault(),e.stopPropagation()
var count=_this2.tribute.current.filteredItems.length,selected=_this2.tribute.menuSelected
count>selected&&selected>0?(_this2.tribute.menuSelected--,_this2.setActiveLi()):0===selected&&(_this2.tribute.menuSelected=count-1,_this2.setActiveLi(),_this2.tribute.menu.scrollTop=_this2.tribute.menu.scrollHeight)}},down:function(e,el){if(_this2.tribute.isActive){e.preventDefault(),e.stopPropagation()
var count=_this2.tribute.current.filteredItems.length-1,selected=_this2.tribute.menuSelected
count>selected?(_this2.tribute.menuSelected++,_this2.setActiveLi()):count===selected&&(_this2.tribute.menuSelected=0,_this2.setActiveLi(),_this2.tribute.menu.scrollTop=0)}},"delete":function(e,el){_this2.tribute.isActive&&_this2.tribute.current.mentionText.length<1?_this2.tribute.hideMenu():_this2.tribute.isActive&&_this2.tribute.showMenuFor(el)}}}},{key:"setActiveLi",value:function(index){var lis=this.tribute.menu.querySelectorAll("li"),length=lis.length>>>0,menuFullHeight=this.getFullHeight(this.tribute.menu),liHeight=this.getFullHeight(lis[0])
index&&(this.tribute.menuSelected=index)
for(var i=0;length>i;i++){var li=lis[i]
if(i===this.tribute.menuSelected){var offset=liHeight*(i+1),scrollTop=this.tribute.menu.scrollTop,totalScroll=scrollTop+menuFullHeight
offset>totalScroll?this.tribute.menu.scrollTop+=liHeight:totalScroll>offset&&(this.tribute.menu.scrollTop-=liHeight),li.className=this.tribute.current.collection.selectClass}else li.className=""}}},{key:"getFullHeight",value:function(elem,includeMargin){var height=elem.getBoundingClientRect().height
if(includeMargin){var style=elem.currentStyle||window.getComputedStyle(elem)
return height+parseFloat(style.marginTop)+parseFloat(style.marginBottom)}return height}}],[{key:"keys",value:function(){return[{key:9,value:"TAB"},{key:8,value:"DELETE"},{key:13,value:"ENTER"},{key:27,value:"ESCAPE"},{key:38,value:"UP"},{key:40,value:"DOWN"}]}}]),TributeEvents}()
exports["default"]=TributeEvents,module.exports=exports["default"]},{}],3:[function(require,module,exports){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0})
var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i]
descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TributeMenuEvents=function(){function TributeMenuEvents(tribute){_classCallCheck(this,TributeMenuEvents),this.tribute=tribute,this.tribute.menuEvents=this,this.menu=this.tribute.menu}return _createClass(TributeMenuEvents,[{key:"bind",value:function(menu){var _this=this
menu.addEventListener("keydown",this.tribute.events.keydown.bind(this.menu,this),!1),this.tribute.range.getDocument().addEventListener("mousedown",this.tribute.events.click.bind(null,this),!1),this.tribute.range.getDocument().addEventListener("MSPointerDown",this.tribute.events.click.bind(null,this),!1),window.addEventListener("resize",this.debounce(function(){_this.tribute.isActive&&_this.tribute.range.positionMenuAtCaret(!0)},300,!1)),this.menuContainer?this.menuContainer.addEventListener("scroll",this.debounce(function(){_this.tribute.isActive&&_this.tribute.showMenuFor(_this.tribute.current.element,!1)},300,!1),!1):window.onscroll=this.debounce(function(){_this.tribute.isActive&&_this.tribute.showMenuFor(_this.tribute.current.element,!1)},300,!1)}},{key:"debounce",value:function(func,wait,immediate){var timeout,_this2=this,_arguments=arguments
return function(){var context=_this2,args=_arguments,later=function(){timeout=null,immediate||func.apply(context,args)},callNow=immediate&&!timeout
clearTimeout(timeout),timeout=setTimeout(later,wait),callNow&&func.apply(context,args)}}}]),TributeMenuEvents}()
exports["default"]=TributeMenuEvents,module.exports=exports["default"]},{}],4:[function(require,module,exports){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0})
var _typeof="function"==typeof Symbol&&"symbol"===_typeof2(Symbol.iterator)?function(obj){return void 0===obj?"undefined":_typeof2(obj)}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":void 0===obj?"undefined":_typeof2(obj)},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i]
descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TributeRange=function(){function TributeRange(tribute){_classCallCheck(this,TributeRange),this.tribute=tribute,this.tribute.range=this}return _createClass(TributeRange,[{key:"getDocument",value:function(){var iframe=void 0
return this.tribute.current.collection&&(iframe=this.tribute.current.collection.iframe),iframe?iframe.contentWindow.document:document}},{key:"positionMenuAtCaret",value:function(scrollTo){var context=this.tribute.current,coordinates=void 0,info=this.getTriggerInfo(!1,!1,!0,this.tribute.allowSpaces)
void 0!==info?(coordinates=this.isContentEditable(context.element)?this.getContentEditableCaretPosition(info.mentionPosition):this.getTextAreaOrInputUnderlinePosition(this.getDocument().activeElement,info.mentionPosition),this.tribute.menu.style.cssText="top: "+coordinates.top+"px;\n                                     left: "+coordinates.left+"px;\n                                     position: absolute;\n                                     zIndex: 10000;\n                                     display: block;",scrollTo&&this.scrollIntoView()):this.tribute.menu.style.cssText="display: none"}},{key:"selectElement",value:function(targetElement,path,offset){var range=void 0,elem=targetElement
if(path)for(var i=0;i<path.length;i++){if(elem=elem.childNodes[path[i]],void 0===elem)return
for(;elem.length<offset;)offset-=elem.length,elem=elem.nextSibling
0!==elem.childNodes.length||elem.length||(elem=elem.previousSibling)}var sel=this.getWindowSelection()
range=this.getDocument().createRange(),range.setStart(elem,offset),range.setEnd(elem,offset),range.collapse(!0)
try{sel.removeAllRanges()}catch(error){}sel.addRange(range),targetElement.focus()}},{key:"resetSelection",value:function(targetElement,path,offset){this.isContentEditable(targetElement)?this.selectElement(targetElement,path,offset):targetElement!==this.getDocument().activeElement&&targetElement.focus()}},{key:"replaceTriggerText",value:function(text,requireLeadingSpace,hasTrailingSpace,originalEvent,item){var context=this.tribute.current,info=this.getTriggerInfo(!0,hasTrailingSpace,requireLeadingSpace,this.tribute.allowSpaces),replaceEvent=new CustomEvent("tribute-replaced",{detail:{item:item,event:originalEvent}})
if(void 0!==info){if(this.isContentEditable(context.element)){var _textSuffix="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" "
text+=_textSuffix,this.pasteHtml(text,info.mentionPosition,info.mentionPosition+info.mentionText.length+1)}else{var myField=this.getDocument().activeElement,textSuffix="string"==typeof this.tribute.replaceTextSuffix?this.tribute.replaceTextSuffix:" "
text+=textSuffix
var startPos=info.mentionPosition,endPos=info.mentionPosition+info.mentionText.length+textSuffix.length
myField.value=myField.value.substring(0,startPos)+text+myField.value.substring(endPos,myField.value.length),myField.selectionStart=startPos+text.length,myField.selectionEnd=startPos+text.length}context.element.dispatchEvent(replaceEvent)}}},{key:"pasteHtml",value:function(html,startPos,endPos){var range=void 0,sel=void 0
sel=this.getWindowSelection(),range=this.getDocument().createRange(),range.setStart(sel.anchorNode,startPos),range.setEnd(sel.anchorNode,endPos),range.deleteContents()
var el=this.getDocument().createElement("div")
el.innerHTML=html
for(var frag=this.getDocument().createDocumentFragment(),node=void 0,lastNode=void 0;node=el.firstChild;)lastNode=frag.appendChild(node)
range.insertNode(frag),lastNode&&(range=range.cloneRange(),range.setStartAfter(lastNode),range.collapse(!0),sel.removeAllRanges(),sel.addRange(range))}},{key:"getWindowSelection",value:function(){return this.tribute.collection.iframe?this.tribute.collection.iframe.contentWindow.getSelection():window.getSelection()}},{key:"getNodePositionInParent",value:function(element){if(null===element.parentNode)return 0
for(var i=0;i<element.parentNode.childNodes.length;i++){var node=element.parentNode.childNodes[i]
if(node===element)return i}}},{key:"getContentEditableSelectedPath",value:function(ctx){var sel=this.getWindowSelection(),selected=sel.anchorNode,path=[],offset=void 0
if(null!=selected){for(var i=void 0,ce=selected.contentEditable;null!==selected&&"true"!==ce;)i=this.getNodePositionInParent(selected),path.push(i),selected=selected.parentNode,null!==selected&&(ce=selected.contentEditable)
return path.reverse(),offset=sel.getRangeAt(0).startOffset,{selected:selected,path:path,offset:offset}}}},{key:"getTextPrecedingCurrentSelection",value:function(){var context=this.tribute.current,text=""
if(this.isContentEditable(context.element)){var selectedElem=this.getWindowSelection().anchorNode
if(null!=selectedElem){var workingNodeContent=selectedElem.textContent,selectStartOffset=this.getWindowSelection().getRangeAt(0).startOffset
workingNodeContent&&selectStartOffset>=0&&(text=workingNodeContent.substring(0,selectStartOffset))}}else{var textComponent=this.tribute.current.element
if(textComponent){var startPos=textComponent.selectionStart
textComponent.value&&startPos>=0&&(text=textComponent.value.substring(0,startPos))}}return text}},{key:"getTriggerInfo",value:function(menuAlreadyActive,hasTrailingSpace,requireLeadingSpace,allowSpaces){var _this=this,ctx=this.tribute.current,selected=void 0,path=void 0,offset=void 0
if(this.isContentEditable(ctx.element)){var selectionInfo=this.getContentEditableSelectedPath(ctx)
selectionInfo&&(selected=selectionInfo.selected,path=selectionInfo.path,offset=selectionInfo.offset)}else selected=this.getDocument().activeElement
var effectiveRange=this.getTextPrecedingCurrentSelection()
if(void 0!==effectiveRange&&null!==effectiveRange){var _ret=function(){var mostRecentTriggerCharPos=-1,triggerChar=void 0
if(_this.tribute.collection.forEach(function(config){var c=config.trigger,idx=config.requireLeadingSpace?_this.lastIndexWithLeadingSpace(effectiveRange,c):effectiveRange.lastIndexOf(c)
idx>mostRecentTriggerCharPos&&(mostRecentTriggerCharPos=idx,triggerChar=c,requireLeadingSpace=config.requireLeadingSpace)}),mostRecentTriggerCharPos>=0&&(0===mostRecentTriggerCharPos||!requireLeadingSpace||/[\xA0\s]/g.test(effectiveRange.substring(mostRecentTriggerCharPos-1,mostRecentTriggerCharPos)))){var currentTriggerSnippet=effectiveRange.substring(mostRecentTriggerCharPos+1,effectiveRange.length)
triggerChar=effectiveRange.substring(mostRecentTriggerCharPos,mostRecentTriggerCharPos+1)
var firstSnippetChar=currentTriggerSnippet.substring(0,1),leadingSpace=currentTriggerSnippet.length>0&&(" "===firstSnippetChar||" "===firstSnippetChar)
hasTrailingSpace&&(currentTriggerSnippet=currentTriggerSnippet.trim())
var regex=allowSpaces?/[^\S ]/g:/[\xA0\s]/g
if(!leadingSpace&&(menuAlreadyActive||!regex.test(currentTriggerSnippet)))return{v:{mentionPosition:mostRecentTriggerCharPos,mentionText:currentTriggerSnippet,mentionSelectedElement:selected,mentionSelectedPath:path,mentionSelectedOffset:offset,mentionTriggerChar:triggerChar}}}}()
if("object"===(void 0===_ret?"undefined":_typeof(_ret)))return _ret.v}}},{key:"lastIndexWithLeadingSpace",value:function(str,char){for(var reversedStr=str.split("").reverse().join(""),index=-1,cidx=0,len=str.length;len>cidx;cidx++){var firstChar=cidx===str.length-1,leadingSpace=/\s/.test(reversedStr[cidx+1]),match=char===reversedStr[cidx]
if(match&&(firstChar||leadingSpace)){index=str.length-1-cidx
break}}return index}},{key:"isContentEditable",value:function(element){return"INPUT"!==element.nodeName&&"TEXTAREA"!==element.nodeName}},{key:"getTextAreaOrInputUnderlinePosition",value:function(element,position){var properties=["direction","boxSizing","width","height","overflowX","overflowY","borderTopWidth","borderRightWidth","borderBottomWidth","borderLeftWidth","paddingTop","paddingRight","paddingBottom","paddingLeft","fontStyle","fontVariant","fontWeight","fontStretch","fontSize","fontSizeAdjust","lineHeight","fontFamily","textAlign","textTransform","textIndent","textDecoration","letterSpacing","wordSpacing"],isFirefox=null!==window.mozInnerScreenX,div=this.getDocument().createElement("div")
div.id="input-textarea-caret-position-mirror-div",this.getDocument().body.appendChild(div)
var style=div.style,computed=window.getComputedStyle?getComputedStyle(element):element.currentStyle
style.whiteSpace="pre-wrap","INPUT"!==element.nodeName&&(style.wordWrap="break-word"),style.position="absolute",style.visibility="hidden",properties.forEach(function(prop){style[prop]=computed[prop]}),isFirefox?(style.width=parseInt(computed.width)-2+"px",element.scrollHeight>parseInt(computed.height)&&(style.overflowY="scroll")):style.overflow="hidden",div.textContent=element.value.substring(0,position),"INPUT"===element.nodeName&&(div.textContent=div.textContent.replace(/\s/g," "))
var span=this.getDocument().createElement("span")
span.textContent=element.value.substring(position)||".",div.appendChild(span)
var rect=element.getBoundingClientRect(),doc=document.documentElement,windowLeft=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),windowTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),coordinates={top:rect.top+windowTop+span.offsetTop+parseInt(computed.borderTopWidth)+parseInt(computed.fontSize)-element.scrollTop,left:rect.left+windowLeft+span.offsetLeft+parseInt(computed.borderLeftWidth)}
return this.getDocument().body.removeChild(div),coordinates}},{key:"getContentEditableCaretPosition",value:function(selectedNodePosition){var markerTextChar="\ufeff",markerEl=void 0,markerId="sel_"+(new Date).getTime()+"_"+(""+Math.random()).substr(2),range=void 0,sel=this.getWindowSelection(),prevRange=sel.getRangeAt(0)
range=this.getDocument().createRange(),range.setStart(sel.anchorNode,selectedNodePosition),range.setEnd(sel.anchorNode,selectedNodePosition),range.collapse(!1),markerEl=this.getDocument().createElement("span"),markerEl.id=markerId,markerEl.appendChild(this.getDocument().createTextNode(markerTextChar)),range.insertNode(markerEl),sel.removeAllRanges(),sel.addRange(prevRange)
var rect=markerEl.getBoundingClientRect(),doc=document.documentElement,windowLeft=(window.pageXOffset||doc.scrollLeft)-(doc.clientLeft||0),windowTop=(window.pageYOffset||doc.scrollTop)-(doc.clientTop||0),coordinates={left:rect.left+windowLeft,top:rect.top+markerEl.offsetHeight+windowTop}
return markerEl.parentNode.removeChild(markerEl),coordinates}},{key:"scrollIntoView",value:function(elem){var reasonableBuffer=20,clientRect=void 0,maxScrollDisplacement=100,e=this.menu
if(void 0!==e){for(;void 0===clientRect||0===clientRect.height;)if(clientRect=e.getBoundingClientRect(),0===clientRect.height&&(e=e.childNodes[0],void 0===e||!e.getBoundingClientRect))return
var elemTop=clientRect.top,elemBottom=elemTop+clientRect.height
if(0>elemTop)window.scrollTo(0,window.pageYOffset+clientRect.top-reasonableBuffer)
else if(elemBottom>window.innerHeight){var maxY=window.pageYOffset+clientRect.top-reasonableBuffer
maxY-window.pageYOffset>maxScrollDisplacement&&(maxY=window.pageYOffset+maxScrollDisplacement)
var targetY=window.pageYOffset-(window.innerHeight-elemBottom)
targetY>maxY&&(targetY=maxY),window.scrollTo(0,targetY)}}}}]),TributeRange}()
exports["default"]=TributeRange,module.exports=exports["default"]},{}],5:[function(require,module,exports){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0})
var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i]
descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TributeSearch=function(){function TributeSearch(tribute){_classCallCheck(this,TributeSearch),this.tribute=tribute,this.tribute.search=this}return _createClass(TributeSearch,[{key:"simpleFilter",value:function(pattern,array){var _this=this
return array.filter(function(string){return _this.test(pattern,string)})}},{key:"test",value:function(pattern,string){return null!==this.match(pattern,string)}},{key:"match",value:function(pattern,string,opts){opts=opts||{}
var pre=(string.length,opts.pre||""),post=opts.post||"",compareString=opts.caseSensitive&&string||string.toLowerCase()
pattern=opts.caseSensitive&&pattern||pattern.toLowerCase()
var patternCache=this.traverse(compareString,pattern,0,0,[])
return patternCache?{rendered:this.render(string,patternCache.cache,pre,post),score:patternCache.score}:null}},{key:"traverse",value:function(string,pattern,stringIndex,patternIndex,patternCache){if(pattern.length===patternIndex)return{score:this.calculateScore(patternCache),cache:patternCache.slice()}
if(!(string.length===stringIndex||pattern.length-patternIndex>string.length-stringIndex)){for(var c=pattern[patternIndex],index=string.indexOf(c,stringIndex),best=void 0,temp=void 0;index>-1;){if(patternCache.push(index),temp=this.traverse(string,pattern,index+1,patternIndex+1,patternCache),patternCache.pop(),!temp)return best;(!best||best.score<temp.score)&&(best=temp),index=string.indexOf(c,index+1)}return best}}},{key:"calculateScore",value:function(patternCache){var score=0,temp=1
return patternCache.forEach(function(index,i){i>0&&(patternCache[i-1]+1===index?temp+=temp+1:temp=1),score+=temp}),score}},{key:"render",value:function(string,indices,pre,post){var rendered=string.substring(0,indices[0])
return indices.forEach(function(index,i){rendered+=pre+string[index]+post+string.substring(index+1,indices[i+1]?indices[i+1]:string.length)}),rendered}},{key:"filter",value:function(pattern,arr,opts){var _this2=this
return opts=opts||{},arr.reduce(function(prev,element,idx,arr){var str=element
opts.extract&&(str=opts.extract(element),str||(str=""))
var rendered=_this2.match(pattern,str,opts)
return null!=rendered&&(prev[prev.length]={string:rendered.rendered,score:rendered.score,index:idx,original:element}),prev},[]).sort(function(a,b){var compare=b.score-a.score
return compare?compare:a.index-b.index})}}]),TributeSearch}()
exports["default"]=TributeSearch,module.exports=exports["default"]},{}],6:[function(require,module,exports){function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}Object.defineProperty(exports,"__esModule",{value:!0})
var _Tribute=require("./Tribute"),_Tribute2=_interopRequireDefault(_Tribute)
exports["default"]=_Tribute2["default"],module.exports=exports["default"]},{"./Tribute":1}],7:[function(require,module,exports){if(Array.prototype.find||(Array.prototype.find=function(predicate){if(null===this)throw new TypeError("Array.prototype.find called on null or undefined")
if("function"!=typeof predicate)throw new TypeError("predicate must be a function")
for(var value,list=Object(this),length=list.length>>>0,thisArg=arguments[1],i=0;length>i;i++)if(value=list[i],predicate.call(thisArg,value,i,list))return value}),window&&"function"!=typeof window.CustomEvent){var CustomEvent=function(event,params){params=params||{bubbles:!1,cancelable:!1,detail:void 0}
var evt=document.createEvent("CustomEvent")
return evt.initCustomEvent(event,params.bubbles,params.cancelable,params.detail),evt}
void 0!==window.Event&&(CustomEvent.prototype=window.Event.prototype),window.CustomEvent=CustomEvent}},{}]},{},[6])(6)})
